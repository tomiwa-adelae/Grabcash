generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String        @id
  name                 String
  email                String        @unique
  username             String?       @unique
  displayUsername      String?
  phoneNumber          String?
  country              String?
  bio                  String?
  accountName          String?
  bankName             String?
  bankCode             String?
  accountNumber        String?
  emailVerified        Boolean
  image                String?
  dob                  String?
  identificationType   String?
  identificationNumber String?
  onboardingCompleted  Boolean?      @default(false)
  credits              Int           @default(20)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  earnings             Int           @default(0)
  isAdmin              Boolean       @default(false)
  status               UserStatus    @default(ACTIVE)
  lifeTimeEarnings     Int           @default(0)
  withdrawalPin        String?
  applicants           Applicant[]
  jobs                 Job[]
  jobPayments          JobPayment[]
  Payment              Payment[]
  payouts              Payout[]
  subscription         Subscription?
  accounts             Account[]
  following            Follow[]      @relation("UserFollowing")
  followers            Follow[]      @relation("UserFollowers")
  sessions             Session[]
  socials              Socials[]

  @@unique([email, username])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Socials {
  id     String @id @default(uuid())
  url    String
  userId String
  User   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("socials")
}

model Job {
  id                 String       @id @default(uuid())
  type               String
  title              String
  slug               String?      @unique
  description        String?
  category           String?
  jobLink            String?
  reward             String?
  noOfWorkers        String?
  instructions       String?
  proofOfCompletion  String?
  submissionType     String?
  submissionRequired String?
  finalNotes         String?
  status             JobStatus    @default(DRAFT)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  userId             String
  paymentVerified    Boolean      @default(false)
  jobID              String?      @unique
  jobOpen            Boolean      @default(true)
  filledSlots        Int          @default(0)
  applicants         Applicant[]
  User               User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPayments        JobPayment[]

  @@unique([slug, userId])
}

model SubscriptionPlan {
  id           String         @id @default(uuid())
  name         String         @default("Basic")
  billingCycle BillingCycle   @default(MONTHLY)
  price        String
  durationDays String
  description  String
  features     Json?
  badge        String?
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  Payment      Payment[]
  Subscription Subscription[]
}

model Subscription {
  id                 String             @id @default(uuid())
  startDate          DateTime
  endDate            DateTime
  status             SubscriptionStatus
  userId             String             @unique
  subscriptionPlanId String
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @default(now()) @updatedAt
  plan               SubscriptionPlan   @relation(fields: [subscriptionPlanId], references: [id])
  user               User               @relation(fields: [userId], references: [id])
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  follower    User     @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follow")
}

model JobPayment {
  id            String           @id @default(uuid())
  txRef         String
  transactionId String
  amount        String
  status        JobPaymentStatus @default(PENDING)
  userId        String
  jobId         String
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  Job           Job              @relation(fields: [jobId], references: [id])
  User          User             @relation(fields: [userId], references: [id])
}

model Applicant {
  id              String               @id @default(uuid())
  userId          String
  jobId           String
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  paragraph       String?
  screenshots     String[]             @default([])
  shortText       String?
  status          JobApplicationStatus @default(PENDING)
  applicationID   String               @unique
  rejectionReason String?
  Job             Job                  @relation(fields: [jobId], references: [id])
  User            User                 @relation(fields: [userId], references: [id])

  @@unique([userId, jobId])
}

model Payment {
  id                 String           @id @default(uuid())
  amount             String
  transactionId      String
  reference          String
  status             PaymentStatus    @default(PENDING)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  userId             String
  subscriptionPlanId String
  plan               SubscriptionPlan @relation(fields: [subscriptionPlanId], references: [id])
  user               User             @relation(fields: [userId], references: [id])
}

model Payout {
  id            String       @id @default(uuid())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  userId        String
  amount        Int
  fee           Int
  bankName      String?
  accountNumber String?
  accountName   String?
  title         String?
  withdrawal    Boolean?     @default(false)
  type          PayoutType?
  status        PayoutStatus @default(PENDING)
  User          User         @relation(fields: [userId], references: [id])
}

enum PayoutType {
  DEBIT
  CREDIT
}

enum JobStatus {
  DRAFT
  PUBLISHED
  DELETED
  ARCHIVED
}

enum BillingCycle {
  MONTHLY
  ANNUALLY
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum JobPaymentStatus {
  PENDING
  FAILED
  REFUNDED
  SUCCESS
}

enum JobApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DELETED
  UNVERIFIED
}

enum PayoutStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
  REJECTED
  CANCELLED
}
